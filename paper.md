# <center>基于 python 的个人网站设计与开发</center>

**【摘要】** 如今个人网站已经成为人们沟通交流展现自我发表接受信息的新的形式，不仅对传统交流工具和信息媒体产生了巨大的冲击，同时也带来了一场大规模的社会革命，作为社交媒体的一部分，对生活就业、政府和法律等方面都带来了巨大的影响。本次选题意义在于利用现今的网站开发技术，建设一个更加开放，安全，便捷使用以及更加完善的个人网站，使人们能够更好的享受互联网带来的便利。  
&emsp;&emsp;这篇文章首先阐明了当今个人网站的现状以及网站开发的的步骤，简要分析了海内外个人网站实现的形式以及涉及的模式，在此基础上探索基于 Python-Django 框架的开发技术。分析其优劣难易程度从而选定合适的插件与模块弥补 Django 框架的不足。  
&emsp;&emsp;在此基础之上对整个系统进行设计，将整个系统的功能划分为若干子功能，针对子功能设计划分组织良好的模块，然后进行简单的数据库设计。然后实现个人完整的所有功能并且整个系统经过单元测试、集成测试、系统测试，验证的整个系统的健壮性。  
&emsp;&emsp;最后对成果进行概括总结并提出改进建议。  
**【关键词】**&emsp;python，Django，网站，社交

# <center>第 1 章 绪论</center>

## **1.** 选题的背景和意义

### **1.1**&ensp;选题的背景

&emsp;&emsp;随着互联网与人们生活日益密切以及网络技术的飞速进步，传统的交流媒介、交流方式还有交流对象都发生革命性的变化，个人网站飞速兴起并且逐渐成为了人们网络生活中不可或缺的一部分。个人网站是一个人们展现自我，与人交流的强大工具。作为社交网站的一部分，个人网站上课可以发布文章、图片和聊天，并且读者能够留下自己评论。随着信息的全球化，越来越多的人们希望通过个人网站了解相隔异地朋友的信息，如果能抓住这个时机，适时的推出新颖方便的个人网站系统，那一定能够使得国内个人网站企业提升一个台阶。  
&emsp;&emsp;个人网站作为人们查找信息、沟通交流和展示自我的新平台，核心的功能是用户浏览信息，发布信息和用户与用户之间进行交流。当前个人网站功能繁杂但缺少部分实用功能，且很难保证用户隐私问题。本课题尝试开发一个功能全面且保证个人隐私的个人网站，建设一个更加开放，安全，便捷使用以及更加完善的个人网站，使人们能够更好的享受互联网带来的便利。

### **1.2**&ensp;国内外研究现状

&emsp;&emsp;个人网站作为社交媒体的一部分在国外正在不同领域，发挥着越来越来大的作用。以国外的 facebook，twitter 为代表，发挥的作用已经远远超过了其本身，在政治与经济生活中都扮演了举足轻重的角色。个人网站的形式也十分多样化，人们除了分享文字图片外，人们还可以发布音频，视频，发起投票和调研等。因此个人网站每天都产生巨大的信息量。国内个人网站发展的势头很猛，一大批个人网站如雨后春笋般兴起，我曾经在移动应用开发课程中制作一款主题为新闻时事的个人博客 app，主要功能为发表个人博客与图片，浏览当今新闻时事和好友发表的博客内容，并且对相关文本与图片进行评论修改于删除，本次毕业设计的想法基于这些内容，并做了功能上的扩充，最典型的就是增加了实时聊天的功能。在如今这个数字化的世界里，不管国内还是国外，人们的工作与生活都很大的依赖于网络，个人网站的出现正式随着这种变化而兴起，成为人们信息交流的新场所。  
&emsp;&emsp;国外一些欧美国家中，在这方面有着更加长久的历史与积淀，因此个人网站发展更加成熟。而国内个人网站的出现与普及较落后，且加上一些政策的限制，发展不如发达国家，但如今国内的势头不输国外。个人网站的开发方式多种多样，目前 html+JavaScript 是主流的前端页面制作，不论国内国外都是如此。而服务端的开发则有所差异，国内的 python 制作的网站还在少数，国外在网站制作上使用 python 语言的不在少数，例如 youtube 就是用 python 编写的。目前 python 的使用已经非常普及，家喻户晓的 pythonweb 框架有 Django，支持异步高并发的 Tornado 框架，短小精悍的 flask,bottle，这些技术使得个人网站的开发更加便捷快速。如果在未来在 web 开发上，python 能与 Java 更好的结合，那将会大大推动相关领域的进步。

### **1.3**&ensp;本文研究的主要内容

&emsp;&emsp;本次课题主要研究基于 python 的个人网站开发，本课题主要针对用户发布个人信息，浏览他人信息，并且支持评论以及实时的聊天，设计并完成一个可靠的个人网站。当前个人网站功能繁杂但缺少部分实用功能，且很难保证用户隐私问题。本课题尝试开发一个功能全面且保证个人隐私的个人网站。本次网站设计在管理员模块与以往一些网站的不同之处或者新颖之处在于增加了一个审核模块的，用户发布的信息必须由管理员和一定的过滤算法审核过后经允许才能发布。文字内容方面采用敏感词过滤系统并建立反垃圾信息机制，图片内容方面主要依赖于人工智能的监制。本次个人网站的开发与设计与市面上的以及过去课程中制作的个人博客的设计与开发的不同之处或者说新颖之处在于本次个人网站开发与设计后端完全使用 python 语言编写，并选取 Django 或者其他框架使得开发更加便捷接口模块等更加清晰。在功能上与以往的个人网站的不同之处或者是新颖之处在于加入了实时聊天的功能。比如 qq 空间等个人网站只支持评论与发布信息等，并不支持两个用户之间聊天。这使得两个用户在同一个网站上的交流变得很不方便。

# <center>第 2 章 相关技术介绍</center>

## **2.1** Django

&emsp;&emsp;Django 是一个基于 Python 的免费开源 web 框架，他遵循 MVC（model-view-template）结构模式。它主要由 Django Software Foundation（DSF），一个独立的非营利性组织来维护。Django 的主要目标是减轻复杂的，数据库驱动的网页的开发。这个框架强调组件的重用性和可插拔性，更少的代码，更少的耦合，快速开发和不欺骗你自己的原则。Python 的使用贯穿始终，即使是设置文件和数据模型。Django 同时也提供了一个可选择的管理员的新建，读，更新和删除接口，这是通过 introspection 和通过管理模型配置动态生成的。

## **2.2** ORM(对象关系映射)

&emsp;&emsp;对象关系映射模式是一种为了解决面向对象与关系数据库存在的互不匹配的现象的技术。简单的说，ORM 是通过使用描述对象和数据库之间映射的元数据，将程序中的对象自动持久化到关系数据库中。ORM 解决的主要问题是对象关系的映射。域模型和关系模型分别是建立在概念模型的基础上的。域模型是面向对象的，而关系模型是面向关系的。一般情况下，一个持久化类和一个表对应，类的每个实例对应表中的一条记录，类的每个属性对应表的每个字段。Django-orm 实现了数据模型与数据库的解耦，即数据模型的设计不需要依赖于特定的数据库，通过简单的配置就可以轻松更换数据库。它主要的任务是根据对象的类型生成表结构、将对象、列表的操作，转换为 sql 语句和将 sql 查询到的结果转换为对象、列表。

## **2.3** Django-templates(模板)

&emsp;&emsp;Django 自带模板是一个文本字符串，旨在将文档与其数据分开。 一个模板定义了占位符和各种基本逻辑（模板标签）的各个部分，用来管理文档应该如何显示。 通常，模板用于生成 HTML，但 Django 模板同样能够生成任何基于文本的格式。模板的思想是在 HTML 代码中嵌入 Python 代码，但是模板系统是为了表示图像，而不是程序逻辑。Django 项目可以配置一个或多个模板引擎（如果不使用模板，甚至可以设置为零）。 Django 为其自己的模板系统（Django 模板语言（DTL））提供了一个内置的后端。 Django 1.11 还包括对流行的 Jinja2 的选择性支持。

## **2.4** Websocket

&emsp;&emsp;简单来说，WebSocket 是一种协议，与 HTTP 协议一样位于应用层，都是 TCP/IP 协议的子集。HTTP 协议是单向通信协议，只有客户端发起 HTTP 请求，服务端才会返回数据。而 WebSocket 协议是双向通信协议，在建立连接之后，客户端和服务器都可以主动向对方发送或接受数据。WebSocket 协议建立的前提需要借助 HTTP 协议，建立连接之后，持久连接的双向通信就与 HTTP 协议无关了。WebSocket 协议的目标是在一个独立的持久连接上提供全双工双向通信。客户端和服务器可以向对方主动发送和接受数据。在 JS 中创建 WebSocket 后，会有一个 HTTP 请求发向浏览器以发起请求。在取得服务器响应后，建立的连接会使用 HTTP 升级将 HTTP 协议转换为 WebSocket 协议。也就是说，使用标准的 HTTP 协议无法实现 WebSocket，只有支持那些协议的专门浏览器才能正常工作。

## **2.5** Django-channels

&emsp;&emsp;Django 是建立在请求和响应的简单概念之上的：浏览器发出请求，Django 调用一个视图，它返回一个响应并发送回浏览器。这在 WebSockets 中是行不通的 ！视图的生命周期只在一个请求当中，没有一种机制能打开一个连接不断的发送数据到客户端，而不发送相关请求。Channels,简而言之,取代了 Django 中的“guts” ——请求/响应周期发送跨通道的消息。Channels 允许 Django 以非常类似于传统 HTTP 的方式支持 WebSockets。Channels 也允许在运行 Django 的服务器上运行后台任务。HTTP 请求表现以前一样,但也通过 Channels 进行路由。Channels 基本上就是任务队列：消息被生产商推到通道，然后传递给监听通道的消费者之一。Django Channels 通过网络工作，使生产者和消费者透明地运行在多台机器上。这个网络层称为通道层。通道设计时使用 Redis 作为其首选通道层.

## **2.6** SQlite

&emsp;&emsp;SQlite 是一个关系型数据库管理系统。与其他许多数据库管理系统相比，SQlite 不是一个客户-服务器数据库引擎。相反，他是被嵌入到终端程序中。SQlite 遵从 ACID 并且实现了大多数 SQL 标准，通常遵循 PostgreSQL 语法。然而，SQlite 使用了一种动态的，弱类型的 SQL 语法，这并不能保证域完整性。这意味着你可以将一个字符串类型插入到一个被定义为整型的列中。SQlite 将尝试在两种合适的格式间转换数据类型，但是并不保证这种转换，如果转换不能进行就按照数据原来的样子存储。作为在类似 web 浏览器这样的应用软件的本地或者客户端嵌入式数据库，SQlite 是一个很受欢迎的选择，SQlite 无疑是最广泛部署的数据库引擎，如今正被广泛的应用于一些知名的浏览器，操作系统，和嵌入式系统，SQlite 还被绑定于许多变成语言。

## **2.7** 本章小结

&emsp;&emsp;本章主要论述了本次研究所使用的 Python-Django 框架及其完成整个系统所依赖的部分技术。整个项目主要是在 Django 这个重量级的框架下使用 Python 语言进行开发，通过使用 Django-orm，Django-templates 等技术降低开发的复杂度与耦合度。使整个系统的结构更加清晰，易于测试。同时发挥 Python 这门语言的有时，以最少的语言编写出功能全面的博客系统。Django 是建立在请求和响应的简单概念之上的：浏览器发出请求，Django 调用一个视图，它返回一个响应并发送回浏览器。这在 WebSockets 中是行不通的，为了弥补 Django 这方面的不足，Channels 允许 Django 以非常类似于传统 HTTP 的方式支持 WebSockets。Channels 也允许在运行 Django 的服务器上运行后台任务。HTTP 请求表现以前一样,但也通过 Channels 进行路由。最后 SQlite 提供了的一个轻便的可嵌入的数据库系统。以上这些技术的使用使得本次系统的成功开发成为可能。

# <center>第 3 章网站的需求分析与总体设计</center>

## **3.1** 网站的需求分析

&emsp;&emsp;个人网站主要提供这样一个平台，用户能够在网站上发布自己的文章，相册与图片。并且能够通过评论，聊天与其他用户发生联系。同时存在管理员对文章进行审核，保证网站内容的优质。本网站最重要的功能就是实现用户浏览发布信息并于其他用户产生联系。

&emsp;&emsp;对于尚未注册或尚未登陆的用户来说，可以简单浏览文章目录，但是无法查看详细的信息。当用户点击特定的条目后页面会自行跳转到登陆或者注册页面。

&emsp;&emsp;对于普通用户来说，登陆后可以查看所有通过审核的文章，并且能够在对应的文章下方发布评论。普通用户可以创作自己的文章并且对文章进行修改，且能够评论自己的文章。当然用户也能够浏览其他人通过审核的文章，并且在其文章下方进行评论。文章的作者有权利修改删除自己的文章，有权利删除自己文章下方的评论。但是没有权力删除修改他人的文章和评论。用户进入个人中心可以查看我的相册，我的文章，以及个人资料。在我的相册界面可以编辑相册，删除相册和新建相册。点击进入相册可以浏览相册中的相片，并且可以编辑图片，删除图片和创建图片。在我的文章界面，用户可以浏览自己发布的文章，点击进入文章后可以进行编辑文章，删除文章和删除评论。在个人资料界面，用户可以浏览自己的个人信息，可以完善个人信息，修改个人信息，当然也可以修改密码，同时用户可以选择上传自己的照片作为头像，使其他用户更好的了解自己。在动态界面，用户可以浏览到所有用户发布的消息，点击可以进入相对应的界面。在主页，有一个搜索框可以进行文章的搜索，点击搜索后进入搜索页面，此时可以按照不同的条件筛选搜索结果。普通用户可以点击其他用户的名字，进入消息页面发送消息。同时也可以接受其他人的消息并进行回复，这样的设计增加了用户在使用的网站过程中的乐趣与互动性。在导航栏中，还有一个登出按钮，使得用户在离开时可以退出网页，保证了个人信息的安全。

&emsp;&emsp;对于管理员来说,登陆时可以选择管理员选项进入管理员界面。在进入管理员界面后，管理员可以查看所有用户的信息，管理员可以点击用户进入相应的管理界面，管理员有权利修改用户的基本资料，但是无法查看用户的密码。管理员可以选择一个普通用户成为管理员，也有权修改一个管理员成为普通用户。这样的机制是为了管理员方便管理用户信息，同时对于像密码这样的私密信息给予了充分的保护。管理员界面中还有文章管理界面，列举了所有用户发布的文章，管理员有权利审核文章是否通过，只有审核通过的文章才能在网站首页上显示，这样的过程充分保证了网站内容的优质。管理员界面还有搜索界面，管理员可以对文章或者时用户信息进行搜索，页面上显示搜索结果，方便管理员的查找节约了大量的时间。导航栏上还有登出按钮，可以确保管理员在离开时退出网站，保证了个人信息的安全，同时也保证了整个网站内容的安全。

&emsp;&emsp;这样多种不同身份看到的不同内容的机制可以在最大程度上保证网站有序的运行，同时也使得用户体验得到极大的提高。更方便了管理员对于整个网站的管理。

## **3.2** 网站的整体框架和模块设计

&emsp;&emsp;本网站主要由用户和管理员两大模块组成。用户这一大的模块又可以细分为文章模块，图片模块，聊天模块，搜索模块和评论模块。管理员这一大的模块又可以细分为用户管理模块，文章管理模块。这些模块功能相似又有区别。整个网站的结构组织也大致分为两大内容，一是用户，二是管理员。整个完整的组织结构如下图 3.1 所示
![avatar](</photo/个人网站组织图(3.1).png>)

**<center><font size=2>图 3.1 个人网站组织图</font></center>**

## **3.3** 网站的流程设计

&emsp;&emsp;本网站有着十分清晰明确的流程。对于普通用户部分，用户可以先进入注册页面进行注册，注册完成后得到自己的账号进行登陆，登陆后可以查看所有通过审核的文章，用户能够在文章下发自由发表言论。用户可以发布自己的文章。在主页，有一个搜索框可以进行文章的搜索，点击搜索后进入搜索页面，此时可以按照不同的条件筛选搜索结果。在个人中心，作者有权利修改删除自己的文章，有权利删除自己文章下方的评论。但是没有权力删除修改他人的文章和评论。用户进入个人中心可以查看我的相册，我的文章，以及个人资料。在我的相册界面可以编辑相册，删除相册和新建相册。点击进入相册可以浏览相册中的相片，并且可以编辑图片，删除图片和创建图片。在我的文章界面，用户可以浏览自己发布的文章，点击进入文章后可以进行编辑文章，删除文章和删除评论。在个人资料界面，用户可以浏览自己的个人信息，可以完善个人信息，修改个人信息，当然也可以修改密码，同时用户可以选择上传自己的照片作为头像，使其他用户更好的了解自己。在动态界面，用户可以浏览到所有用户发布的消息，点击可以进入相对应的界面。普通用户可以点击其他用户的名字，进入消息页面发送消息。同时也可以接受其他人的消息并进行回复。普通用户系统流程图如图 3.2 所示。

&emsp;&emsp;管理员系统的大致流程是管理员登陆管理界面，在管理员界面中，管理员可以对所有用户进行管理，在管理员界面中，管理员可以对所有用户的文章进行管理。管理员系统流程图如图 3.3 所示。

![avatar](</photo/个人网站普通用户系统流程图(3.2).png>)

**<center><font size=2>图 3.2 个人网站普通用户系统流程图</font></center>**

![avatar](</photo/个人网站管理员系统流程图(3.3).png>)

**<center><font size=2>图 3.3 个人网站管理员系统流程图</font></center>**

## **3.4** 网站的数据库设计

&emsp;&emsp;个人网站的开发过程中数据库起了必不可少的数据存储管理的作用，本网站选择 SQlite 作为本次开发的数据库管理系统，同时应用了 Django-orm 技术。在数据库中本网站一共涉及了六张数据表。这些表分别是用户表，文章表，相册表，图片表，评论表和动态表。这些表的作用分别是保存用户信息，保存文章的信息，保存相册的信息，保存图片的信息，保存评论的信息和保存动态信息。这些表相互之间的制约关系保证的数据的正确与完整性。个人网站的数据库的内容如图 3.4 所示。

![avatar](</photo/个人网站数据库图(3.4).png>)

**<center><font size=2>图 3.4 个人网站数据库图</font></center>**

&emsp;&emsp;（1）用户表（User），该表的详细表结构如下表3.1所示：

**<center><font size=2>表 3.1 用户表</font></center>**

|  name  |         type          | description  |
| :----: | :-------------------: | :----------: |
|   id   | VARCHAR(100) NOT NULL | PRIMARY KEY  |
|  pwd   | VARCHAR(100) NOT NULL |     密码     |
|  name  | VARCHAR(100) NOT NULL |    用户名    |
|  head  | VARCHAR(100) NOT NULL |   头像地址   |
| types  |          INT          | 是否为管理员 |
| gender |          INT          |     性别     |
| friend |          INT          | （外键）好友 |

&emsp;&emsp;用户的id作为主键，这是系统自动生成的并且自增不会重复。这保证了所有用户的唯一性。在进行登陆注册时需验证账号存在且密码相匹配才能登陆成功否则登陆失败，管理员的登陆时出来检查账号密码还要检查类型是否为管理员，只有当类型为管理员账号密码类型都正确时才登陆成功，否则登陆失败，head用来记录用户的头像信息，gender用来记录用户的性别信息，friend用来记录用户的好友信息。

&emsp;&emsp;（2）文章表（Article），该表的详细表结构如下表3.2所示：

**<center><font size=2>表 3.2 文章表</font></center>**

|   name   |         type          |   description    |
| :------: | :-------------------: | :--------------: |
|    id    | VARCHAR(100) NOT NULL |   PRIMARY KEY    |
|  title   | VARCHAR(100) NOT NULL |     文章标题     |
| content  | VARCHAR(100) NOT NULL |     文章内容     |
| writerid | VARCHAR(100) NOT NULL |  （外键）作者id  |
|  ctime   |         date          |   文章创建时间   |
|  photo   |     VARCHAR(100)      |     图片地址     |
|  audit   |        boolean        | 文章是否通过审核 |

&emsp;&emsp;文章的id作为主键，这是系统自动生成的并且自增不会重复。这保证了所有文章的唯一性。在文章表中title用来记录文章的标题不能为空，content用来记录文章的内容，不能为空。writerid是外键，用来记录文章的作者，ctime用来记录文章的创建时间，photo用来记录文章的图片地址，audit用来记录文章是否通过审核。

&emsp;&emsp;（3）相册表（Album），该表的详细表结构如下表3.3所示：

**<center><font size=2>表 3.3 相册表</font></center>**

|  name  |         type          |      description       |
| :----: | :-------------------: | :--------------------: |
|   id   | VARCHAR(100) NOT NULL |      PRIMARY KEY       |
| title  | VARCHAR(100) NOT NULL |        相册标题        |
| userid | VARCHAR(100) NOT NULL | （外键）相册拥有者的id |
| ctime  |         date          |      相册创建时间      |
| cover  |     VARCHAR(100)      |      相册封面地址      |

&emsp;&emsp;相册的id作为主键，这是系统自动生成的并且自增不会重复。这保证了所有相册的唯一性。在相册表中title用来记录相册的标题不能为空，userid是外键，用来记录相册的作者，ctime用来记录相册的创建时间。

&emsp;&emsp;（4）图片表（Photo），该表的详细表结构如下表3.3所示：

**<center><font size=2>表 3.4 图片表</font></center>**

|   name    |         type          |      description       |
| :-------: | :-------------------: | :--------------------: |
|    id     | VARCHAR(100) NOT NULL |      PRIMARY KEY       |
|   title   | VARCHAR(100) NOT NULL |        图片标题        |
|  userid   | VARCHAR(100) NOT NULL | （外键）图片拥有者的id |
|  albumid  | VARCHAR(100) NOT NULL |    （外键）相册的id    |
| articleid | VARCHAR(100) NOT NULL |    （外键）文章的id    |
|   ctime   |         date          |      图片创建时间      |
|    pic    |     VARCHAR(100)      |        图片地址        |

&emsp;&emsp;图片的id作为主键，这是系统自动生成的并且自增不会重复。这保证了所有图片的唯一性。在图片表中title用来记录图片的标题不能为空，userid是外键，用来记录图片的作者，ctime用来记录图片的创建时间，albumid是外键用来记录该图片是属于哪个相册，articleid是外键，用来记录图片是属于哪个文章，pic记录图片的地址。

&emsp;&emsp;（5）评论表（Comments），该表的详细表结构如下表3.3所示：

**<center><font size=2>表 3.5 评论表</font></center>**

|   name    |         type          |      description       |
| :-------: | :-------------------: | :--------------------: |
|    id     | VARCHAR(100) NOT NULL |      PRIMARY KEY       |
|  userid   | VARCHAR(100) NOT NULL |   （外键）评论者的id   |
| articleid | VARCHAR(100) NOT NULL | （外键）评论的文章的id |
|  content  | VARCHAR(100) NOT NULL |       评论的内容       |
|   ctime   |         date          |     评论的创建时间     |

&emsp;&emsp;评论的id作为主键，这是系统自动生成的并且自增不会重复。这保证了所有评论的唯一性。在评论表中content用来记录评论的内容不能为空，userid是外键，用来记录评论的作者，ctime用来记录评论的创建时间，articleid是外键用来记录该评论是属于哪个文章。

&emsp;&emsp;（6）动态表（Publish），该表的详细表结构如下表3.3所示：

**<center><font size=2>表 3.6 动态表</font></center>**

|   name    |         type          |      description       |
| :-------: | :-------------------: | :--------------------: |
|    id     | VARCHAR(100) NOT NULL |      PRIMARY KEY       |
|  userid   | VARCHAR(100) NOT NULL | （外键）动态发布者的id |
| articleid | VARCHAR(100) NOT NULL | （外键）动态的文章的id |
|  albumid  | VARCHAR(100) NOT NULL | （外键）动态的相册的id |
|  photoid  | VARCHAR(100) NOT NULL | （外键）动态的图片的id |
|   ctime   |         date          |     动态的创建时间     |

&emsp;&emsp;动态的id作为主键，这是系统自动生成的并且自增不会重复。这保证了所有动态的唯一性。在动态表中，userid是外键，用来记录动态的作者，ctime用来记录动态的创建时间，articleid是外键用来记录该动态是属于哪个文章。albumid是外键用来记录该动态是属于哪个相册。photoid是外键用来记录该动态是属于哪个相册。

&emsp;&emsp;以上就是整个系统所用到的全部的六张表，各个表之间相互联系，相互牵制，更加灵活的在实际使用中管理整个网站的数据。


# <center>第 4 章网站功能模块的详细设计与开发</center>

## **4.1** 普通用户功能模块介绍

&emsp;&emsp;普通用户功能模块主要是普通用户的客户端操作界面，主要由一下五大部分组成，分别是用户登陆注册模块，搜索和分类筛选模块，文章功能模块，相册图片模块和聊天模块。

### **4.1.1** 用户登陆注册模块

&emsp;&emsp;登陆注册功能是一个确保用户体验和保证用户个人信息隐私安全的基础模块。网站中有登陆界面和注册界面来引导用户进行登陆和注册。

&emsp;&emsp;本网站的用户是扩展了django.contrib.auth.models中原有的用户User模型，注册时使用的表单也是调用了django.contrib.auth.forms中的UserCreationForm的表单对象。用户输入的信息正确与否都由后端Django的库函数regform.is_valid()进行判断。当输入注册信息不合法时会有相应的提示。如图4.1所示。后端代码中主要引用模块和主要调用语句如下：

from django.contrib.auth.models import User

from django.contrib.auth.forms import UserCreationForm

from django.contrib.auth import authenticate,login

def mregister(request):  
&emsp;&emsp;if request.method =='POST':  
&emsp;&emsp;&emsp;&emsp;regform = UserCreationForm(request.POST)  
&emsp;&emsp;&emsp;&emsp;if regform.is_valid():  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;regform.save()  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;user = authenticate(username=regform.cleaned_data['username'],password=regform.cleaned_data['password1'])  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;login(request,user)  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;return redirect('pblog:home')  
&emsp;&emsp;else:  
&emsp;&emsp;&emsp;&emsp;regform = UserCreationForm()  
&emsp;&emsp;content = {'regform':regform}  
&emsp;&emsp;return render(request,'pblog/register.html',content)   

&emsp;&emsp;登陆时根据传到后端的用户输入的用户名和密码，调用Django的django.contrib.auth模块中的函数authenticate来验证用户是否存在，该函数返回一个user对象，user = authenticate(request,username=request.POST['username'],password=request.POST['password'])，如何user为空，那么说明登陆失败，否则登陆成功。用户在未登录时不能查看文章的详细信息，点击文章后会跳转到登陆界面，登陆拦截功能调用Django的django.contrib.auth.decorators中的login_required函数。@login_required(login_url='pblog:login')改修饰函数能够将为登陆的请求重新定位到登陆界面，登陆界面如下图4.2所示。

![avatar](/photo/注册模块界面（4.1）.png)

**<center><font size=2>图 4.1 注册模块界面图</font></center>**

![avatar](/photo/登陆模块界面（4.2）.png)

**<center><font size=2>图 4.2 登陆模块界面图</font></center>**

### **4.1.2** 搜索和分类筛选模块

&emsp;&emsp;用户登陆后在主页导航栏搜索框内输入所要查询的文章的关键词，点击搜索后跳转的搜索页面查看搜索结果，或者直接点击搜索按钮进入搜索页面，在搜索页面中可以对文章，用户以及动态进行分类搜索筛选。后端代码中主要引用模块和主要语句如下：
search=request.GET['search']  
categ=request.GET['category']  
users=None  
articles=None  
if categ=='用户':  
&emsp;&emsp;if search:  
&emsp;&emsp;&emsp;&emsp;users=User.objects.filter(username__icontains=search)  
&emsp;&emsp;&emsp;&emsp;print(users)  
elif categ=='文章':  
&emsp;&emsp;if search:  
&emsp;&emsp;&emsp;&emsp;articles=MARTICLE.objects.filter(title__icontains=search)  
result={'users':users,'articles':articles}  

### **4.1.3** 文章功能模块

&emsp;&emsp;用户进入网站后首先看到已经审核通过的文章列表，点击相应的条目后进入文章内容，并且可以对自己的文章或者他人的添加评论。文章的详细内容界面如下图4.3所示。同时在主页可以创建新的文章，进入个人中心后可以对文章内容进行修改，或者删除文章和删除评论。个人中心我的界面如下图4.4所示。

![avatar](/photo/文章查看界面（4.3）.png)

**<center><font size=2>图 4.3 文章查看界面图</font></center>**

![avatar](/photo/我的文章编辑界面（4.4）.png)

**<center><font size=2>图 4.4 我的文章编辑界面图</font></center>**

### **4.1.4** 相册图片模块

&emsp;&emsp;用户进入个人中心我的相册模块界面后，可以浏览已经创建的所有相册，并且可以创建新的相册，编辑相册和删除相册。点击进入相册后可以浏览该相册的所有图片，并且可以创建新的图片，编辑图片和删除图片，点击图片后可以查看图片的详细信息。我的相册界面如下图4.5所示。相册内图片的界面如下图4.6所示。

![avatar](/photo/相册界面（4.5）.png)

**<center><font size=2>图 4.5 相册界面图</font></center>**

![avatar](/photo/相册图片模块界面（4.6）.png)

**<center><font size=2>图 4.6 相册图片模块界面图</font></center>**

### **4.1.5** 聊天模块

&emsp;&emsp;用户点击网站上其他用户后进入聊天界面，可以发送信息给其他用户，同时可以接受其他用户的信息，使用了Django-channels插件弥补了Django不支持websocket的缺陷。

## **4.2** 管理员功能模块介绍

&emsp;&emsp;管理员功能模块主要负责管理员身份的用户在系统中对用户文章等信息进行管理，同时也是为了保证整个网站有序的运行保证用户个人信息的安全以及保证网站内容的优质与健康。管理员功能模块主要时使得管理员能够方便的登入管理员界面，更好的管理文章与用户信息。英雌管理员功能模块主要有四大部分，分别是

### **4.2.1** 管理员登陆模块

&emsp;&emsp;管理员登陆时要在管理员界面勾选管理员这个选项，若用户的类型为管理员则登陆成功，进入管理员界面，若不勾选管理员选项则默认进入普通用户界面。若用户类型为普通用户，则同样进入普通用户界面。

### **4.2.2** 管理员搜索模块

&emsp;&emsp;管理员登陆后在主页搜索框内输入所要查询的文章的关键词，点击搜索后跳转的搜索页面查看搜索结果，或者直接点击搜索按钮进入搜索页面，在搜索页面中可以对文章，用户以及进行分类搜索筛选。后端代码中主要引用模块和主要语句和普通用户的搜索类似。

### **4.2.3** 文章管理模块

&emsp;&emsp;管理员对搜索得到的文章或者直接查看到文章列表中的文章进行管理，文章管理界面有所有文章列表，每一条项目都有标识审核通过与不通过。这方便管理对文章进行审核。文章管理模块界面如下图4.7所示。点击进入选定的文章后可以对文章进行审核。管理员可以选择未通过的文章通过，也可以将已通过的文章的内容更改为未通过。文章审核界面如下图4.8所示。后端中主要的引用模块和主要调用的代码如下：  
if request.method == 'POST':  
&emsp;&emsp;article = MARTICLE.objects.get(id = article_id)  
&emsp;&emsp;article.audit = True  
&emsp;&emsp;article.save()  
article = MARTICLE.objects.get(id = article_id)  
comments = MCOMMENT.objects.filter(article = article)  
content = {'article':article,'comments':comments}  
return render(request,'pblog/adminarticle.html',content)  

![avatar](/photo/文章管理模块界面（4.7）.png)

**<center><font size=2>图 4.7 文章管理模块界面图</font></center>**

![avatar](/photo/文章审核界面（4.8）.png)

**<center><font size=2>图 4.8 文章审核界面图</font></center>**

### **4.2.4** 用户管理模块

&emsp;&emsp;管理员对搜索得到的用户或者直接查看到用户列表中的用户进行管理，用户管理界面有所有用户列表，这方便管理对用户进行审核。用户管理模块界面如下图4.9所示。点击进入选定的用户后可以对用户进行管理。管理员可以修改用户的资料，也可以将已通过的普通用户设置为管理员，但是管理员不能查看用户的铭文密码，这是为了保护用户的个人隐私。用户管理界面如下图4.9所示。后端中主要的引用模块和主要调用的代码如下：  

if request.method == 'POST':  
&emsp;&emsp;user=User.objects.get(id=user_id)  
&emsp;&emsp;form=infoform(request.POST,instance=user)  
&emsp;&emsp;print(user.muser.head)  
&emsp;&emsp;if form.is_valid():  
&emsp;&emsp;&emsp;&emsp;form.save()  
&emsp;&emsp;&emsp;&emsp;if request.POST['gender'] == 'male':  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;user.muser.gender=True  
&emsp;&emsp;&emsp;&emsp;else:  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;user.muser.gender=False  
&emsp;&emsp;&emsp;&emsp;user.muser.save()  
&emsp;&emsp;&emsp;&emsp;if request.FILES.get('head'):  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;name=user.muser.head  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;print(settings.MEDIA_ROOT+'/'+str(name))  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;f=request.FILES.get('head')  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;fname = settings.MEDIA_ROOT+'/'+str(name)  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;with open(fname,'wb+') as pic:  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;for c in f.chunks():  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;pic.write(c)  
&emsp;&emsp;return redirect('pblog:adminuserinfo',user_id)     
user=MUSER.objects.get(id=user_id)  
return render(request,'pblog/adminuserinfo.html',{'muser':user})  

![avatar](/photo/用户管理界面（4.9）.png)

**<center><font size=2>图 4.9 用户管理界面图</font></center>**

# <center>第 5 章系统测试</center>

## **5.1** 测试原则

&emsp;&emsp;软件测试的目的是为了发现软件设计和实现过程中因疏忽所造成的错误。测试所花费的工作量经常比其他任何软件工程活动都多。若测试时无计划进行的，则既浪费时间又浪费不必要的劳动。甚至更糟的是，错误为被测出，因而隐蔽下来。因此，为测试软件建立系统化的测试策略是合情合理的。测试从“小范围开始”，并逐步过渡到“软件整体”。这意味着，早期的测试关注单个构件或相关的一小组构件，利用测试发现封装在构建中的数据错误和逻辑错误。当完成单个构建的测试后，需要将构建收集起来，知道建成整个系统。

&emsp;&emsp;从许多方面看，测试都是一个独立的过程，并且同软件开发一样，测试类型也有很多种。测试可以是事先计划并可以系统的进行的一系列活动。因此，应该为软件过程定义软件测试模板，即将特定的测试用例技术和测试方法放到一系列的测试步骤中去。文献中已经提到了许多软件测试策略。软件测试策略必须提供必要的低级测试，可以验证小段源代码是否正确实现，也要提供高级测试，用来确认系统的主要功能是否满足用户需求。由于测试策略的步骤往往是在软件完成的最后期限的压力开始呈现时才刚刚进行，因此，测试的进度必须是可测量的，并且应该让问题尽可能早的暴露。

## **5.2** 测试用例与结果

&emsp;&emsp;本网站系统的测试主要是普通用户模块测试和管理员模块测试。对于普通用户功能模块而言，进行的测试主要是用户登陆注册，对文章的增删改查，对相册的增删改查，对图片的增删改查，对动态的增删改查，对个人信息的增删改查，用户发起聊天，用户留言的增删改查。对于管理员功能模块而言，进行的测试在进行测试前首先会设计一些列测试用例，形成一张测试用例列表，按照列表进行测试后将测试结果填上。普通用户功能模块的单元测试用例列表如下表5.1所示。

**<center><font size=2>表 5.1 网站测试用例及其结果汇总</font></center>**


|用例编号|测试对象|测试条件|预期结果|实际结果|
|:---:|:---:|:---:|:---:|:---:|
|TS01TC01|普通用户注册|输入重复用户名|提示用户名重复|pass|
|TS01TC02|普通用户注册|两次密码不一致|提示两次密码不一致|pass|
|TS01TC03|普通用户注册|输入简单常见密码|提示密码太常见或过与简单|pass|
|TS01TC04|普通用户注册|正确输入|注册成功|pass|
|TS02TC01|普通用户登陆|用户名不存在|登陆失败|pass|
|TS02TC02|普通用户登陆|密码错误|登陆失败|pass|
|TS02TC03|普通用户登陆|用户名和密码输入正确|登陆成功|pass|
|TS03TC01|普通用户创作文章|标题不存在或内容不存在|提交失败|pass|
|TS03TC02|普通用户创作文章|标题和内容皆不为空|提交成功|pass|
|TS03TC03|普通用户编辑文章|修改文章内容|提交成功|pass|
|TS03TC04|普通用户删除文章|点击删除按钮|提交成功|pass|
|TS04TC01|普通用户发表评论|评论内容为空|提交失败|pass|
|TS04TC02|普通用户发表评论|评论内容不为空|提交成功|pass|
|TS05TC01|普通用户创建相册|相册标题为空|提交失败|pass|
|TS05TC02|普通用户创建相册|相册标题不空，封面或描述为空|提交成功|pass|
|TS05TC03|普通用户编辑相册|修改相应信息|修改成功|pass|
|TS05TC04|普通用户删除相册|点击删除|删除成功|pass|
|TS06TC01|普通用户创建图片|图片标题为空|提交失败|pass|
|TS06TC02|普通用户创建图片|图片标题不空|提交成功|pass|
|TS06TC03|普通用户编辑图片|修改相应信息|修改成功|pass|
|TS06TC04|普通用户删除图片|点击删除|删除成功|pass|
|TS07TC01|普通用户修改个人信息|修改相应的条目|修改成功|pass|
|TS08TC01|普通用户修改密码|输入旧密码错误|修改失败|pass|
|TS08TC02|普通用户修改密码|输入旧密码正确，输入新密码简单常见|修改失败，提示密码太常见或过与简单|pass|
|TS08TC03|普通用户修改密码|输入旧密码正确，新密码符合要求|修改成功|pass|

# <center>结论</center>

&emsp;&emsp;本文首先阐述了当前时代背景下个人网站的作用以及其重要的意义，同时大致说明了个人网站在国内外的研究现状，引出本文的主要内容，对基于python个人网站开发的研究。本文主要针对用户发布个人信息，浏览他人信息，并且支持评论以及实时的聊天，设计并完成一个可靠的个人网站。

&emsp;&emsp;围绕这研究的主题，文本简要列举了开发网站的相关技术如Django框架，ORM对象关系映射，Django-templates模板引擎，SQlite数据库管理系统和支持websocket的Django-channels插件。接着对网站进行需求分析和总体设计，在完成需求分析的基础上对网站进行总体设计和详细设计。最后对网站进行测试，保证保证的质量与健壮性。

&emsp;&emsp;本次个人网站的所有开发都有本人一人完成，网站仍然存在许多小的瑕疵，但是基本的核心功能都已经完成，可以算作是一个合格的个人网站。并且在网站的开发过程中学习了python与Django的使用，加深了对python语言的理解。整个网站需要完善的地方将在下一阶段的研究中进行完善。